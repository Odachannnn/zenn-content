---
title: "ã€MySQLã€‘WHERE BETWEENã¯æœ¬å½“ã«é€Ÿã„ã®ã‹ ~datetimeã‚«ãƒ©ãƒ ã®å ´åˆ~"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["MySQL"]
published: true
---
## ã¯ã˜ã‚ã«
ã“ã®å‰ä»•äº‹ã®æœ¬ç•ªç’°å¢ƒã«ã¦ã€ã‚ã‚‹SQLãŒã„ã¤ã®é–“ã«ã‹4000msã»ã©ã‹ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
WHEREå¥ã§ä½¿ç”¨ã—ã¦ã„ãŸdatetimeå‹ã®ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å¼µã£ã¦ãŠã‚‰ãšã€
100ä¸‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ãŒèµ°ã£ã¦ã„ãŸã“ã¨ãŒåŸå› ã®ï¼‘ã¤ã§ã—ãŸã€‚

ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å¼µã‚Šã€é€Ÿåº¦ã‚‚70msã«çŸ­ç¸®ã§ããŸã®ã§ä¸Šé•·ã«å ±å‘Šã—ãŸã¨ã“ã‚ã€
**ã€Œã‚‚ã¨ã‚‚ã¨ã®SQLã¯æ¯”è¼ƒæ¼”ç®—å­ã§çµã£ã¦ã‚‹ã®ï¼Ÿã€€BETWEENã®æ–¹ãŒé€Ÿã„ã‚“ã˜ã‚ƒãªã„ï¼Ÿã€**
ã¨ã®æŒ‡æ‘˜ãŒã‚ã£ãŸã®ã§æ¤œè¨¼ã‚’è¡Œã„ã¾ã—ãŸã€‚
 
MySQLã§ã¯åº¦ã€…
**ã€ŒWHEREå¥ã§ç¯„å›²ã‚’çµã‚‹ã¨ãã¯æ¯”è¼ƒæ¼”ç®—å­ã‚ˆã‚Šã‚‚BETWEENã®æ–¹ãŒé€Ÿã„ã€**
ã¨è¨€ã‚ã‚Œã¾ã™ã€‚

æœ¬å½“ã«BETWEENæ¼”ç®—å­ã¯é€Ÿã„ã®ã‹ã€æ¤œè¨¼ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

:::message 
ã“ã®è¨˜äº‹ã®æ¤œè¨¼ã¯datetimeå‹ã®ã‚«ãƒ©ãƒ ã‚’å¯¾è±¡ã¨ã—ã¦ã„ã¾ã™ã€‚
:::

:::message alert
ã¾ã ã¾ã SQLã®çŸ¥è­˜ãŒæµ…ã„ãŸã‚ã€èªè­˜èª¤ã‚Šã‚„èª¤è¨˜ãªã©ã®è‡³ã‚‰ãªã„ç‚¹ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã€Œã“ã“é–“é•ã£ã¦ã‚‹ãªã€ã€ã€ã¨æ°—ä»˜ã‹ã‚ŒãŸæ–¹ã¯ã€ã”æŒ‡æ‘˜ãã ã•ã‚‹ã¨ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚
:::


## å¯¾è±¡èª­è€…
#### â– å¯¾è±¡
SQLåˆå¿ƒè€…ã®æ–¹ã€‚


## çµè«–
ãƒ» BETWEENã‚ˆã‚Šã‚‚æ¯”è¼ƒæ¼”ç®—å­ã®æ–¹ãŒé€Ÿã„ã“ã¨ãŒã‚ã‚‹ã€‚
ãƒ» `CAST('Y-m-d H:i:s' as datetime)`ç­‰ã€ã¡ã‚ƒã‚“ã¨å‹å¤‰æ›ã™ã‚‹ã¨BETWEENæ¼”ç®—å­ã®æ–¹ãŒé€Ÿã„ã€‚


## æ¤œè¨¼ç’°å¢ƒ
- Google Cloud SQL vCPU2, ãƒ¡ãƒ¢ãƒª8GB, SSDã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸100GB
- MySQL version: 8.0.26

### ãƒ†ãƒ¼ãƒ–ãƒ«æƒ…å ±
#### ãƒ†ãƒ¼ãƒ–ãƒ«
```
+-----------+----------+------+-----+---------+----------------+
| Field     | Type     | Null | Key | Default | Extra          |
+-----------+----------+------+-----+---------+----------------+
| id        | int      | NO   | PRI | NULL    | auto_increment |
| user_id   | int      | NO   |     | NULL    |                |
| page_id   | int      | YES  |     | NULL    |                |
| viewed_at | datetime | NO   | MUL | NULL    |                |
+-----------+----------+------+-----+---------+----------------+
```
#### æ ¼ç´ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°
ã²ã¨ã¾ãš200ä¸‡ä»¶ã»ã©ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
```
mysql> select count(*) from user_history;
+----------+
| count(*) |
+----------+
|  2050048 |
+----------+
1 row in set (0.18 sec)
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
datetimeå‹ã®ã‚«ãƒ©ãƒ ã«å¼µã£ã¦ã„ã¾ã™ã€‚
```
+--------------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table        | Non_unique | Key_name          | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+--------------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| user_history |          0 | PRIMARY           |            1 | id          | A         |     1997216 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| user_history |          1 | index_on_viewd_at |            1 | viewed_at   | A         |     1997216 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+--------------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
```

## æ¤œè¨¼
view_atã‚«ãƒ©ãƒ ã«å¯¾ã—ã¦ç‰¹å®šã®ç¯„å›²ã®è¡Œã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã®SELECTæ–‡ã®å®Ÿè¡Œè¨ˆç”»ã‚’ã€æ¯”è¼ƒæ¼”ç®—å­ã¨BETWEENæ¼”ç®—å­ã‚’ä½¿ã£ã¦ãã‚Œãã‚Œè©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚


### æ¯”è¼ƒæ¼”ç®—å­ã‚’ä½¿ç”¨ã—ãŸå®Ÿè¡Œè¨ˆç”»
```
mysql> explain analyze select count(id) from user_history where viewed_at >= '2023-01-01 00:00:00' and viewed_at <= '2023-03-30 23:59:59';
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -> Aggregate: count(user_history.id)  (cost=300212.19 rows=998608) (actual time=491.761..491.762 rows=1 loops=1)
    -> Filter: ((user_history.viewed_at >= TIMESTAMP'2023-01-01 00:00:00') and (user_history.viewed_at <= TIMESTAMP'2023-03-30 23:59:59'))  (cost=200351.39 rows=998608) (actual time=0.032..428.378 rows=1163251 loops=1)
        -> Index range scan on user_history using index_on_viewd_at  (cost=200351.39 rows=998608) (actual time=0.030..278.750 rows=1163251 loops=1)
 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.58 sec)
```

**æ¯”è¼ƒæ¼”ç®—å­ã®çµæœã¯ã€0.58ç§’ã§ã—ãŸã€‚**

### BETWEENæ¼”ç®—å­ã‚’ä½¿ç”¨ã—ãŸå®Ÿè¡Œè¨ˆç”»
```
mysql> explain analyze select count(id) from user_history where viewed_at between '2023-01-01 00:00:00' and '2023-03-30 23:59:59';
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -> Aggregate: count(user_history.id)  (cost=300212.19 rows=998608) (actual time=801.417..801.418 rows=1 loops=1)
    -> Filter: (user_history.viewed_at between '2023-01-01 00:00:00' and '2023-03-30 23:59:59')  (cost=200351.39 rows=998608) (actual time=0.040..737.879 rows=1163251 loops=1)
        -> Index range scan on user_history using index_on_viewd_at  (cost=200351.39 rows=998608) (actual time=0.033..286.074 rows=1163251 loops=1)
 |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.92 sec)
```

**BETWEENæ¼”ç®—å­ã®çµæœã¯ã€0.92ç§’ã§ã—ãŸã€‚**

## çµæœ
**æ¤œè¨¼ã®çµæœã€æ¯”è¼ƒæ¼”ç®—å­ã®æ–¹ãŒ0.34ç§’é€Ÿã„ã¨ã„ã†çµæœã«ãªã‚Šã¾ã—ãŸã€‚**

ä¸€èˆ¬çš„ã«ã€ŒBETWEENã®æ–¹ãŒæ¯”è¼ƒæ¼”ç®—å­ã‚ˆã‚Šé€Ÿã„ã€ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã®ã«ã€
ã©ã†ã—ã¦BETWEENæ¼”ç®—å­ã®æ–¹ãŒé…ããªã£ã¦ã—ã¾ã£ãŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

## BETWEENæ¼”ç®—å­ã®ç‰¹å¾´
MySQLãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®BETWEENæ¼”ç®—å­ã«é–¢ã™ã‚‹é …ç›®ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

>æ—¥ä»˜ã¾ãŸã¯æ™‚é–“ã®å€¤ã¨ã¨ã‚‚ã« BETWEEN ã‚’ä½¿ç”¨ã—ãŸã¨ãã®çµæœã‚’æœ€é©ã«ã™ã‚‹ã«ã¯ã€CAST() ã‚’ä½¿ç”¨ã—ã¦æ˜ç¤ºçš„ã«å€¤ã‚’ç›®çš„ã®ãƒ‡ãƒ¼ã‚¿å‹ã«å¤‰æ›ã—ã¾ã™ã€‚ ä¾‹ : DATETIME ã‚’ 2 ã¤ã® DATE å€¤ã¨æ¯”è¼ƒã™ã‚‹å ´åˆã¯ã€DATE å€¤ã‚’ DATETIME å€¤ã«å¤‰æ›ã—ã¾ã™ã€‚ DATE ã¨ã®æ¯”è¼ƒã§ '2001-1-1' ãªã©ã®æ–‡å­—åˆ—å®šæ•°ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€æ–‡å­—åˆ—ã‚’ DATE ã«ã‚­ãƒ£ã‚¹ãƒˆã—ã¾ã™ã€‚

https://dev.mysql.com/doc/refman/8.0/ja/comparison-operators.html#operator_between

`WHERE viewed_at BETWEEN â€™YYYY-MM-DD hh:mm:ssâ€™ AND â€™YYYY-MM-DD hh:mm:ssâ€™`ã¨ã„ã†æ¡ä»¶ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€BETWEENã®æœ€é©åŒ–ã®æ©æµã‚’ç¢ºå®Ÿã«å—ã‘ã‚‹ã«ã¯ã€ã©ã†ã‚„ã‚‰'YYYY-MM-DD hh:mm:ss'ã‚’æ˜ç¤ºçš„ã«datetimeå‹ã¸ã¨ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

:::message 
ã‚­ãƒ£ã‚¹ãƒˆã—ãªã„å ´åˆã€æ–‡å­—åˆ—ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
:::

### CAST()ã‚’ä½¿ç”¨ã—ãŸBETWEENæ¼”ç®—å­ã®å®Ÿè¡Œè¨ˆç”»
å‹å¤‰æ›ã‚’ã—ãŸã‚‰æœ¬å½“ã«BETWEENãŒé€Ÿããªã‚‹ã®ã‹ã€ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```
mysql> explain analyze select count(id) from user_history where viewed_at between cast('2023-01-01 00:00:00' as datetime) and cast('2023-03-30 23:59:59' as datetime);
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -> Aggregate: count(user_history.id)  (cost=300212.19 rows=998608) (actual time=431.097..431.097 rows=1 loops=1)
    -> Filter: (user_history.viewed_at between <cache>(cast('2023-01-01 00:00:00' as datetime)) and <cache>(cast('2023-03-30 23:59:59' as datetime)))  (cost=200351.39 rows=998608) (actual time=0.032..373.734 rows=1163251 loops=1)
        -> Index range scan on user_history using index_on_viewd_at  (cost=200351.39 rows=998608) (actual time=0.030..275.973 rows=1163251 loops=1)
 |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.49 sec)
```
**çµæœã¯0.49ç§’ã¨ã€æ¯”è¼ƒæ¼”ç®—å­ã‚ˆã‚Š90msé€Ÿããªã‚Šã¾ã—ãŸï¼**

### CAST()ã‚’ä½¿ç”¨ã—ãŸæ¯”è¼ƒæ¼”ç®—å­ã®å®Ÿè¡Œè¨ˆç”»
æ¯”è¼ƒæ¼”ç®—å­ã§ã‚‚CASTã‚’ä½¿ç”¨ã—ãŸã‚‰ã©ã†ãªã‚‹ã®ã‹ã€æ¤œè¨¼ã—ã¦ã¿ã¾ã™ã€‚
```
mysql> explain analyze select count(id) from user_history where viewed_at >= cast('2023-01-01 00:00:00' as datetime) and viewed_at <= cast('2023-03-30 23:59:59' as datetime);
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| EXPLAIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -> Aggregate: count(user_history.id)  (cost=300212.19 rows=998608) (actual time=493.382..493.382 rows=1 loops=1)
    -> Filter: ((user_history.viewed_at >= <cache>(cast('2023-01-01 00:00:00' as datetime))) and (user_history.viewed_at <= <cache>(cast('2023-03-30 23:59:59' as datetime))))  (cost=200351.39 rows=998608) (actual time=0.038..435.449 rows=1163251 loops=1)
        -> Index range scan on user_history using index_on_viewd_at  (cost=200351.39 rows=998608) (actual time=0.034..278.131 rows=1163251 loops=1)
 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.55 sec)
```
æ¯”è¼ƒæ¼”ç®—å­ã®å ´åˆã€CASTã®æœ‰ç„¡ã§ã¯30msã—ã‹å¤‰ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚


## ã¾ã¨ã‚
ä»¥ä¸Šã®å‡¦ç†é€Ÿåº¦ã‚’é€Ÿã„é †ã§ã¾ã¨ã‚ã‚‹ã¨ã€

**1. CAST()ã‚’ä½¿ç”¨ã—ã¦å‹å¤‰æ›ã—ãŸBETWEENæ¼”ç®—å­(0.49ç§’)**
**2. CAST()ã‚’ä½¿ç”¨ã—ã¦å‹å¤‰æ›ã—ãŸæ¯”è¼ƒæ¼”ç®—å­(0.55ç§’)**
**3. CAST()ç„¡ã—ã®æ¯”è¼ƒæ¼”ç®—å­(0.58ç§’)**
**4. CAST()ç„¡ã—ã®BETWEENæ¼”ç®—å­(0.92ç§’)**

ã¨ã„ã†çµæœã«ãªã‚Šã¾ã—ãŸã€‚
ã€ŒWHERE BETWEENã¯æœ¬å½“ã«é€Ÿã„ã®ã‹ã€ã¨ã„ã†å•ã„ã«å¯¾ã—ã¦ã€
ã€ŒCASTã‚’ä½¿ãˆã°é€Ÿã„ã€ã¨ã„ã†æ¤œè¨¼çµæœã«ãªã£ãŸã¨æ€ã„ã¾ã™ã€‚

ãƒãƒƒãƒˆä¸Šã«ã¯ã€å€¤ã®CASTç„¡ã—ã§æ¯”è¼ƒæ¼”ç®—å­ã‚ˆã‚ŠBETWEENæ¼”ç®—å­ã®æ–¹ãŒé€Ÿã„ã¨ã„ã†çµæœã‚’ç´¹ä»‹ã™ã‚‹è¨˜äº‹ã‚‚ã‚ã‚Šã¾ã™ã€‚
å®Ÿè¡Œè¨ˆç”»ã¯ä¸€å®šã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã—ã€CASTã‚’ã—ãªãã¦ã‚‚ä»–ã®æ¡ä»¶ã®å½±éŸ¿ã§BETWEENæ¼”ç®—å­ã®æ–¹ãŒé€Ÿã„ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚‹ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã—ã‹ã—ä»Šå›ã®çµæœã‚„ã€MySQLã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’è¦‹ã‚‹ã«ã€
**BETWEENæ¼”ç®—å­ãŒã„ã¤ã„ã‹ãªã‚‹å ´åˆã§ã‚‚æ¯”è¼ƒæ¼”ç®—å­ã‚ˆã‚Šé€Ÿã„ã¨ã¯ç´„æŸã•ã‚Œã¦ãŠã‚‰ãšã€ç¢ºå®Ÿã«æœ€é©åŒ–ã™ã‚‹ãŸã‚ã«ã¯CASTã™ã‚‹å¿…è¦ãŒã‚ã‚‹**
ã¨ã‚‚è¨€ãˆã‚‹ã®ã‹ã¨æ€ã„ã¾ã—ãŸã€‚

è‡ªåˆ†ã®æ›¸ã„ãŸSQLãŒæœ€é©ã§é©åˆ‡ãªçµæœã‚’å¾—ã‚‰ã‚Œã¦ã„ã‚‹ã‹ã€ä»Šå¾Œæ”¹ã‚ã¦ãã¡ã‚“ã¨ç¢ºèªã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚



## å‚è€ƒ
æ¤œè¨¼ä¸­ã€
**ã€Œãªã‚“ã§æ¯”è¼ƒæ¼”ç®—å­ã¯CASTã—ã¦ã‚‚ã—ãªãã¦ã‚‚ãã‚“ãªã«é€Ÿåº¦ãŒå¤‰ã‚ã‚‰ãªã„ã‚“ã ã‚ã†ï¼Ÿã€**
ã¨ã„ã†åˆ¥ã®ç–‘å•ãŒç”Ÿã¾ã‚Œã¾ã—ãŸã€‚

èª¿æŸ»ã®ãŸã‚æ¯”è¼ƒæ¼”ç®—å­ã®å®Ÿè¡Œè¨ˆç”»ã®ä¸­èº«ã‚’ã‚ˆãã‚ˆãè¦‹ã¦ã¿ã‚‹ã¨ã€
'YYYY-MM-DD hh:mm:ss'ã®å€¤ã®å‰ã«ã€ã‚ã‚‹ãƒªãƒ†ãƒ©ãƒ«ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

```
Filter: ((user_history.viewed_at >= TIMESTAMP'2023-01-01 00:00:00') and (user_history.viewed_at <= TIMESTAMP'2023-03-30 23:59:59')) 
```
**æ—¥ä»˜ã®å‰ã«ã€ã‚‚ã¨ã‚‚ã¨ã®SQLæ–‡ã«ã¯ãªã‹ã£ãŸ`TIMESTAMP`ã¨ã„ã†ãƒªãƒ†ãƒ©ãƒ«ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚**
ã“ã®`TIMESTAMP`ã¨ã„ã†ã®ã¯ã€MySQLãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã¯å‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„typeã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨å‘¼ã°ã‚Œã¦ãŠã‚Šã€å¾Œç¶šã®æ–‡å­—åˆ—ã‚’å‹å¤‰æ›ã™ã‚‹ã‚‚ã®ã®ã‚ˆã†ã§ã™ã€‚
> TIMESTAMP æ§‹æ–‡ã¯ã€MySQL ã§ DATETIME å€¤ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

https://dev.mysql.com/doc/refman/8.0/ja/date-and-time-literals.html

æ¬¡ã«BETWEENæ¼”ç®—å­ã§ã™ã€‚
```
Filter: (user_history.viewed_at between '2023-01-01 00:00:00' and '2023-03-30 23:59:59')
```

BETWEENæ¼”ç®—å­ã®å‰ã«ã¯`TIMESTAMP`ã¨è¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

**ã©ã†ã—ã¦æ¯”è¼ƒæ¼”ç®—å­ã®å ´åˆã®ã¿ã€`TIMESTAMP`ã¨å‹å¤‰æ›ãŒè¡Œã‚ã‚ŒãŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ**


### MySQLã®å¼è©•ä¾¡
ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã¯å¼è©•ä¾¡ã«ã¤ã„ã¦ã€
> ã„ãšã‚Œã‹ã®å¼•æ•°ãŒ TIMESTAMP ã‚«ãƒ©ãƒ ã¾ãŸã¯ DATETIME ã‚«ãƒ©ãƒ ã§ã€ã‚‚ã†ä¸€æ–¹ã®å¼•æ•°ãŒå®šæ•°ã®å ´åˆã€å®šæ•°ã¯æ¯”è¼ƒãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚

ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚
ã‚ˆã£ã¦ã€`viewed_at >= '2023-01-01 00:00:00'` ã¯
**ã€ŒDATETIMEã‚«ãƒ©ãƒ ã€€æ¯”è¼ƒæ¼”ç®—å­ã€€å®šæ•°ã€ã®å½¢ã«å½“ã¦ã¯ã¾ã‚‹ãŸã‚ã€å®šæ•°ãŒã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«å¤‰æ›ã•ã‚ŒãŸ**ã‚ˆã†ã§ã™ã€‚

ä¸€æ–¹ã§BETWEENæ¼”ç®—å­ã«é–¢ã—ã¦ã¯
> ãŸã¨ãˆã°ã€æ—¥ä»˜ã¾ãŸã¯æ™‚é–“ã®å€¤ã¨ã¨ã‚‚ã« BETWEEN ã‚’ä½¿ç”¨ã—ãŸã¨ãã®çµæœã‚’æœ€é©ã«ã™ã‚‹ã«ã¯ã€CAST() ã‚’ä½¿ç”¨ã—ã¦ã€æ˜ç¤ºçš„ã«å€¤ã‚’ç›®çš„ã®ãƒ‡ãƒ¼ã‚¿å‹ã«å¤‰æ›ã—ã¾ã™ã€‚

ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚
ã‚„ã¯ã‚ŠBETWEENæ¼”ç®—å­ã§ã¯æ˜ç¤ºçš„ã«å‹å¤‰æ›ã—ãŸã»ã†ãŒã‚ˆã•ãã†ã§ã™ã€‚

### æ„Ÿæƒ³
MySQLå…¨èˆ¬ã€ç‰¹ã«å‹å‘¨ã‚Šã®çŸ¥è­˜ãŒã‹ãªã‚Šæµ…ã„ãªã¨ç—›æ„Ÿã—ã¾ã—ãŸ...ã€‚ã‚€ãšã‹ã—ã„ã€‚

